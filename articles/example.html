<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ingestr example • ingestr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- Fonts --><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,300;0,400;0,700;1,300;1,400&amp;display=swap" rel="stylesheet">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- geco --><link href="../geco.css" rel="stylesheet">
<meta property="og:title" content="ingestr example">
<!-- Mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js" async integrity="sha256-nlrDrBTHxJJlDDX22AS33xYI1OJHnGMDhiYMSe2U0e0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/config/TeX-AMS-MML_HTMLorMML.js" async integrity="sha256-4zys9A4hMQmtq2EUL+JRoXc0NZi8jVJMzb8onewOaSQ=" crossorigin="anonymous"></script>
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">

    <div class="navbar-header">

      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="external-link hidden-sm hidden-xs" href="https://geco-group.org/">
          <img src="https://raw.githubusercontent.com/computationales/GECO_template/main/geco_logo_white_small.png" id="hexlogo" alt="GECO"></a>
        <a class="external-link hidden-md hidden-lg" href="https://geco-group.org/">
          <img src="https://raw.githubusercontent.com/computationales/GECO_template/main/geco_logo_white_small.png" id="hexlogo" alt="GECO"></a>
        <a class="navbar-brand" href="../index.html">
           <i>ingestr <small>v1.4.2</small></i>
        </a>
      </div>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/calc_daytime_vpd.html">Derived fluxnet variables</a>
    </li>
    <li>
      <a href="../articles/collect_point_environment.html">Collect point-scale climate and soil information</a>
    </li>
    <li>
      <a href="../articles/example.html">ingestr example</a>
    </li>
    <li>
      <a href="../articles/get_drivers_coordinates.html">Ingest P-model drivers from coordinates</a>
    </li>
    <li>
      <a href="../articles/get_evi_gee.html">Getting MODIS EVI data from Google Earth Engine</a>
    </li>
    <li>
      <a href="../articles/ingest_cru_rsofun.html">ingest CRU</a>
    </li>
    <li>
      <a href="../articles/modis_interpolation.html">Interpolation of MODIS data</a>
    </li>
    <li>
      <a href="../articles/run_pmodel_points.html">Run the P-model for point simulations</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/geco-bern/ingestr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>ingestr example</h1>
                        <h4 data-toc-skip class="author">Beni
Stocker</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/geco-bern/ingestr/blob/master/vignettes/example.Rmd" class="external-link"><code>vignettes/example.Rmd</code></a></small>
      <div class="hidden name"><code>example.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The package <code>ingestr</code> provides functions to extract
(ingest) environmental point data (given longitude, latitude, and
required dates) from large global files or remote data servers and
create time series at user-specified temporal resolution (varies for
different data sets).</p>
<ul>
<li>Temporal downscaling from montly to daily resolution</li>
<li>Quality filtering, temporal interpolation and smoothing of remote
sensing data</li>
<li>Handling of different APIs and file formats, returning ingested data
in <em>tidy</em> format.</li>
</ul>
<p>This is to make your life simpler when downloading and reading
site-scale data, using a common interface with a single function for
single-site and multi-site ingest, respectively, and a common and tidy
format of ingested data across a variety of data <em>sources</em> and
formats of original files. <em>Sources</em>, refers to both data sets
hosted remotely and accessed through an API and local data sets. ingestr
is particularly suited for preparing model forcing and offers a set of
functionalities to transform original data into common standardized
formats and units. This includes interpolation methods for converting
monthly climate data (CRU TS currently) to daily time steps.</p>
<p>The key functions are <code><a href="../reference/ingest_bysite.html">ingest_bysite()</a></code> and
<code><a href="../reference/ingest.html">ingest()</a></code> for a single-site data ingest and a multi-site
data ingest, respectively. For the multi-site data ingest, site meta
information is provided through the argument <code>siteinfo</code> which
takes a data frame with columns <code>lon</code> for longitude,
<code>lat</code> for latitude, and (for time series downloads)
<code>year_start</code> and <code>year_end</code>, specifying required
dates (including all days of respective years). Sites are organised
along rows. An example site meta info data frame is provided as part of
this package for sites included in the FLUXNET2015 Tier 1 data set
(additional columns are not required by <code><a href="../reference/ingest_bysite.html">ingest_bysite()</a></code> and
<code><a href="../reference/ingest.html">ingest()</a></code>):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">siteinfo_fluxnet2015</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The following <em>sources</em> can be handled currently:</p>
<table style="width:99%;" class="table">
<colgroup>
<col width="30%">
<col width="7%">
<col width="3%">
<col width="4%">
<col width="4%">
<col width="49%">
</colgroup>
<thead><tr class="header">
<th>Data source</th>
<th>Data type</th>
<th>Coverage</th>
<th>Source ID</th>
<th>Reading from</th>
<th>Remark</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><a href="https://fluxnet.fluxdata.org/data/fluxnet2015-dataset/" class="external-link">FLUXNET</a></td>
<td>time series by site</td>
<td>site</td>
<td><code>fluxnet</code></td>
<td>local files</td>
<td></td>
</tr>
<tr class="even">
<td><a href="http://www.eu-watch.org/data_availability" class="external-link">WATCH-WFDEI</a></td>
<td>time series raster map</td>
<td>global</td>
<td><code>watch_wfdei</code></td>
<td>local files</td>
<td></td>
</tr>
<tr class="odd">
<td><a href="https://crudata.uea.ac.uk/cru/data/hrg/" class="external-link">CRU</a></td>
<td>time series raster map</td>
<td>global</td>
<td><code>cru</code></td>
<td>local files</td>
<td></td>
</tr>
<tr class="even">
<td>MODIS LP DAAC</td>
<td>time series raster map</td>
<td>global</td>
<td><code>modis</code></td>
<td>remote server</td>
<td>using <a href="https://docs.ropensci.org/MODISTools/" class="external-link">MODISTools</a>
</td>
</tr>
<tr class="odd">
<td>Google Earth Engine</td>
<td>time series raster map</td>
<td>global</td>
<td><code>gee</code></td>
<td>remote server</td>
<td>using Koen Hufken’s <a href="https://khufkens.github.io/gee_subset/" class="external-link">gee_suset</a> library</td>
</tr>
<tr class="even">
<td><a href="https://www.ngdc.noaa.gov/mgg/global/" class="external-link">ETOPO1</a></td>
<td>raster map</td>
<td>global</td>
<td><code>etopo1</code></td>
<td>local files</td>
<td></td>
</tr>
<tr class="odd">
<td><a href="https://www.esrl.noaa.gov/gmd/ccgg/trends/data.html" class="external-link">Mauna
Loa CO2</a></td>
<td>time series</td>
<td>site</td>
<td><code>co2_mlo</code></td>
<td>remote server</td>
<td>using the <a href="https://github.com/bczernecki/climate" class="external-link">climate</a> R package</td>
</tr>
<tr class="even">
<td><a href="https://webarchive.iiasa.ac.at/Research/LUC/External-World-soil-database/HTML/" class="external-link">HWSD</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><pre><code>        | raster map, database | global   | `hwsd`        | local files   | using an adaption of David Le Bauer's [rhwsd](https://github.com/dlebauer/rhwsd) R package</code></pre></td>
</tr>
<tr class="odd">
<td><a href="https://databasin.org/datasets/68635d7c77f1475f9b6c1d1dbe0a4c4c" class="external-link">WWF
Ecoregions</a></td>
<td>shapefile map</td>
<td>global</td>
<td><code>wwf</code></td>
<td>local files</td>
<td>Olsen et al. (2001)</td>
</tr>
<tr class="even">
<td><a href="https://link.springer.com/article/10.1007%2Fs10584-011-0155-0" class="external-link">N
deposition</a></td>
<td>time series raster map</td>
<td>global</td>
<td><code>ndep</code></td>
<td>local files</td>
<td>Lamarque et al. (2011)</td>
</tr>
<tr class="odd">
<td><a href="https://www.isric.org/explore/soilgrids" class="external-link">SoilGrids</a></td>
<td>raster map</td>
<td>global</td>
<td><code>soilgrids</code></td>
<td>remote server</td>
<td>Hengl et al. (2017)</td>
</tr>
<tr class="even">
<td><a href="https://data.isric.org/geonetwork/srv/api/records/dc7b283a-8f19-45e1-aaed-e9bd515119bc" class="external-link">ISRIC
WISE30sec</a></td>
<td>raster map</td>
<td>global</td>
<td><code>wise</code></td>
<td>local files</td>
<td><a href="http://dx.doi.org/10.1016/j.geoderma.2016.01.034" class="external-link">Batjes
(2016)</a></td>
</tr>
<tr class="odd">
<td><a href="http://globalchange.bnu.edu.cn/research/soilwd.jsp" class="external-link">GSDE
Soil</a></td>
<td>raster map</td>
<td>global</td>
<td><code>gsde</code></td>
<td>local files</td>
<td><a href="https://doi.org/10.1002/2013MS000293" class="external-link">Shangguan et
al. 2014</a></td>
</tr>
<tr class="even">
<td><a href="https://www.worldclim.org/data/worldclim21.html" class="external-link">WorldClim</a></td>
<td>raster map</td>
<td>global</td>
<td><code>gsde</code></td>
<td>local files</td>
<td><a href="https://doi.org/10.1002/joc.5086" class="external-link">Fick &amp; Hijmans,
2017</a></td>
</tr>
</tbody>
</table>
<p>Examples to read data for a single site for each data type are given
in Section ‘Examples for a single site’. Handling ingestion for multiple
sites is described in Section ‘Example for a set of sites’.
<strong>Note</strong> that this package does not provide the original
data. Please follow links to data sources above where data is read from
local files, and always cite original references.</p>
<div class="section level3">
<h3 id="variable-names-and-units">Variable names and units<a class="anchor" aria-label="anchor" href="#variable-names-and-units"></a>
</h3>
<p>All ingested data follows standardized variable naming and
(optionally) units.</p>
<table style="width:99%;" class="table">
<colgroup>
<col width="42%">
<col width="18%">
<col width="38%">
</colgroup>
<thead><tr class="header">
<th>Variable</th>
<th>Variable name</th>
<th>Units</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Gross primary production</td>
<td><code>gpp</code></td>
<td>g
CO<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mrow><mo>−</mo><mn>2</mn></mrow></msup><annotation encoding="application/x-tex">^{-2}</annotation></semantics></math>
m<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mrow><mo>−</mo><mn>2</mn></mrow></msup><annotation encoding="application/x-tex">^{-2}</annotation></semantics></math>
</td>
</tr>
<tr class="even">
<td>Air temperature</td>
<td><code>temp</code></td>
<td>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>∘</mo></msup><annotation encoding="application/x-tex">^\circ</annotation></semantics></math>C</td>
</tr>
<tr class="odd">
<td>Daily minimum air temperature</td>
<td><code>tmin</code></td>
<td>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>∘</mo></msup><annotation encoding="application/x-tex">^\circ</annotation></semantics></math>C</td>
</tr>
<tr class="even">
<td>Daily maximum air temperature</td>
<td><code>tmax</code></td>
<td>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>∘</mo></msup><annotation encoding="application/x-tex">^\circ</annotation></semantics></math>C</td>
</tr>
<tr class="odd">
<td>Precipitation</td>
<td><code>prec</code></td>
<td>mm
s<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><annotation encoding="application/x-tex">^{-1}</annotation></semantics></math>
</td>
</tr>
<tr class="even">
<td>Vapour pressure deficit</td>
<td><code>vpd</code></td>
<td>Pa</td>
</tr>
<tr class="odd">
<td>Atmospheric pressure</td>
<td><code>patm</code></td>
<td>Pa</td>
</tr>
<tr class="even">
<td>Net radiation</td>
<td><code>netrad</code></td>
<td>J
m<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mrow><mo>−</mo><mn>2</mn></mrow></msup><annotation encoding="application/x-tex">^{-2}</annotation></semantics></math>
s<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi></mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>=</mo></mrow><annotation encoding="application/x-tex">^{-1}=</annotation></semantics></math>
W
m<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mrow><mo>−</mo><mn>2</mn></mrow></msup><annotation encoding="application/x-tex">^{-2}</annotation></semantics></math>
</td>
</tr>
<tr class="odd">
<td>Photosynthetic photon flux density</td>
<td><code>ppfd</code></td>
<td>mol
m<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mrow><mo>−</mo><mn>2</mn></mrow></msup><annotation encoding="application/x-tex">^{-2}</annotation></semantics></math>
s<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><annotation encoding="application/x-tex">^{-1}</annotation></semantics></math>
</td>
</tr>
<tr class="even">
<td>Elevation (altitude)</td>
<td><code>elv</code></td>
<td>m a.s.l.</td>
</tr>
</tbody>
</table>
<p>Use these variable names for specifying which variable names they
correspond to in the original data source (see argument
<code>getvars</code> to functions <code><a href="../reference/ingest.html">ingest()</a></code> and
<code><a href="../reference/ingest_bysite.html">ingest_bysite()</a></code>). <code>gpp</code> is cumulative,
corresponding to the time scale of the data. For example, if daily data
is read, <code>gpp</code> is the total gross primary production per day
(g
CO<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mrow><mo>−</mo><mn>2</mn></mrow></msup><annotation encoding="application/x-tex">^{-2}</annotation></semantics></math>
m<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mrow><mo>−</mo><mn>2</mn></mrow></msup><annotation encoding="application/x-tex">^{-2}</annotation></semantics></math>
d<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><annotation encoding="application/x-tex">^{-1}</annotation></semantics></math>).</p>
</div>
</div>
<div class="section level2">
<h2 id="examples-for-a-single-site">Examples for a single site<a class="anchor" aria-label="anchor" href="#examples-for-a-single-site"></a>
</h2>
<p>The function <code><a href="../reference/ingest_bysite.html">ingest_bysite()</a></code> can be used to ingest data
for a single site. The argument <code>source</code> specifies which data
type (<em>source</em>) is to be read from and triggers the use of
specific wrapper functions that are designed to read from original files
with formats that differ between sources. Source-specific settings for
data processing can be provided by argument <code>settings</code>
(described for each data source below). More info about other,
source-independent arguments are available through the man page (see
<code><a href="../reference/ingest_bysite.html">?ingest_bysite</a></code>).</p>
<div class="section level3">
<h3 id="fluxnet">FLUXNET<a class="anchor" aria-label="anchor" href="#fluxnet"></a>
</h3>
<div class="section level4">
<h4 id="meteo-data">Meteo data<a class="anchor" aria-label="anchor" href="#meteo-data"></a>
</h4>
<p>Reading from FLUXNET files offers multiple settings to be used
specified by the user. Here, we’re specifying that no soil water content
data is read (<code>getswc = FALSE</code> in
<code>settings_fluxnet</code>, passed to <code><a href="../reference/ingest_bysite.html">ingest_bysite()</a></code>
through argument <code>settings</code>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings_fluxnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>getswc <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_fluxnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span><span class="op">(</span></span>
<span>  sitename <span class="op">=</span> <span class="st">"FR-Pue"</span>,</span>
<span>  source <span class="op">=</span> <span class="st">"fluxnet"</span>,</span>
<span>  getvars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>temp <span class="op">=</span> <span class="st">"TA_F"</span>,</span>
<span>                 prec <span class="op">=</span> <span class="st">"P_F"</span>,</span>
<span>                 vpd  <span class="op">=</span> <span class="st">"VPD_F"</span>,</span>
<span>                 ppfd <span class="op">=</span>  <span class="st">"SW_IN_F"</span>,</span>
<span>                 netrad <span class="op">=</span> <span class="st">"NETRAD"</span>,</span>
<span>                 patm <span class="op">=</span> <span class="st">"PA_F"</span><span class="op">)</span>,</span>
<span>  dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">path.package</a></span><span class="op">(</span><span class="st">"ingestr"</span><span class="op">)</span>, <span class="st">"/extdata/"</span><span class="op">)</span>,  <span class="co"># example file delivered through package and located here</span></span>
<span>  settings <span class="op">=</span> <span class="va">settings_fluxnet</span>,</span>
<span>  timescale <span class="op">=</span> <span class="st">"d"</span>,</span>
<span>  year_start <span class="op">=</span> <span class="fl">2007</span>,</span>
<span>  year_end <span class="op">=</span> <span class="fl">2007</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">df_fluxnet</span></span></code></pre></div>
<p><code>getvars</code> defines the variable names in the original files
corresponding to the respective variables with ingestr-standard naming
(see table above). The example above triggers the ingestion of the six
variables
<code>"TA_F", "P_F", "VPD_F",  "SW_IN_F", "NETRAD", "PA_F"</code> for
<code>"temp", "prec", "vpd", "ppfd", "netrad", "patm"</code>,
respectively.</p>
</div>
<div class="section level4">
<h4 id="flux-data">Flux data<a class="anchor" aria-label="anchor" href="#flux-data"></a>
</h4>
<p>The same function can also be used to read in other FLUXNET variables
(e.g., CO2 flux data) and conduct data filtering steps. Here, we’re
reading daily GPP and uncertainty (standard error), based on the
nighttime flux decomposition method (<code>"GPP_NT_VUT_REF"</code> and
<code>"GPP_NT_VUT_SE"</code> in argument <code>getvars</code>). The
<code>settings</code> argument can be used again to specify settings
that are specific to the <code>"fluxnet"</code> data source. Here, we
keep only data where at least 80% is based on non-gapfilled half-hourly
data (<code>threshold_GPP = 0.8</code>), and where the daytime and
nighttime-based estimates are consistent, that is, where their
difference is below the the 97.5% and above the 2.5% quantile
(<code>filter_ntdt = TRUE</code>). Negative GPP values are not removed
(<code>remove_neg = FALSE</code>). We read data for just one year here
(2007).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings_fluxnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  getswc       <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  filter_ntdt  <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  threshold_GPP<span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  remove_neg   <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">ddf_fluxnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span><span class="op">(</span></span>
<span>  sitename  <span class="op">=</span> <span class="st">"FR-Pue"</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"fluxnet"</span>,</span>
<span>  getvars   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> gpp <span class="op">=</span> <span class="st">"GPP_NT_VUT_REF"</span>,</span>
<span>                    gpp_unc <span class="op">=</span> <span class="st">"GPP_NT_VUT_SE"</span><span class="op">)</span>,</span>
<span>  dir       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">path.package</a></span><span class="op">(</span><span class="st">"ingestr"</span><span class="op">)</span>, <span class="st">"/extdata/"</span><span class="op">)</span>,</span>
<span>  settings  <span class="op">=</span> <span class="va">settings_fluxnet</span>,</span>
<span>  timescale <span class="op">=</span> <span class="st">"d"</span>,</span>
<span>  year_start <span class="op">=</span> <span class="fl">2007</span>,</span>
<span>  year_end  <span class="op">=</span> <span class="fl">2007</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="settings">Settings<a class="anchor" aria-label="anchor" href="#settings"></a>
</h4>
<p>The argument <code>settings</code> in functions
<code><a href="../reference/ingest_bysite.html">ingest_bysite()</a></code> and <code><a href="../reference/ingest.html">ingest()</a></code> is used to pass
settings that are specific to the data source (argument
<code>source</code>) with which the functions are used. Default settings
are specified for each data source. For <code>source = "fluxnet"</code>,
defaults are returned by a function call of
<code><a href="../reference/get_settings_fluxnet.html">get_settings_fluxnet()</a></code> and are described in the function’s
man page (see <code><a href="../reference/get_settings_fluxnet.html">?get_settings_fluxnet</a></code>). Defaults are used for
settings elements that are not specified by the user.</p>
</div>
</div>
<div class="section level3">
<h3 id="watch-wfdei">WATCH-WFDEI<a class="anchor" aria-label="anchor" href="#watch-wfdei"></a>
</h3>
<p>Let’s extract data for the location corresponding to FLUXNET site
‘CH-Lae’ (lon = 8.365, lat = 47.4781). This extracts from original
WATCH-WFDEI files, provided as NetCDF (global, 0.5 degree resolution),
provided as monthly files containing all days in each month. The data
directory specified here (<code>dir = "~/data/watch_wfdei/"</code>)
contains sub-directories with names containing the variable names. The
argument <code>getvars</code> works a differently compared to
<code>"fluxnet"</code>. Here, <code>getvars</code> is a vector of
ingestr-standard variable names to be read. ingestr automatically reads
from the respective files with WATCH-WFDEI variable names. Available
variables are: <code>"temp", "ppfd", "vpd", "patm", "prec"</code>. The
latter is the sum of snow and rain. Below, we read data for just one
year here (2007).</p>
<p>A bias correction may be applied by specifying the settings as in the
example below. By specifying <code>correct_bias = "worldclim"</code>
(the only option currently available), this uses a high-resolution
(30’’) monthly climatology based on years 1970-2000 and corrects the
WATCH-WFDEI data by month, based on the difference (ratio for variables
other than temperature) of its monthly means, averaged across
1979-2000.</p>
<p>WATCH-WFDEI data is available for years from 1979. If
<code>year_start</code> is before that, the mean seasonal cycle,
averaged across 1979-1988 is returned for all years before 1979.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_watch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span><span class="op">(</span></span>
<span>  sitename  <span class="op">=</span> <span class="st">"FR-Pue"</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"watch_wfdei"</span>,</span>
<span>  getvars   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"temp"</span><span class="op">)</span>,</span>
<span>  dir       <span class="op">=</span> <span class="st">"~/data/watch_wfdei/"</span>,</span>
<span>  timescale <span class="op">=</span> <span class="st">"d"</span>,</span>
<span>  year_start <span class="op">=</span> <span class="fl">2018</span>,</span>
<span>  year_end  <span class="op">=</span> <span class="fl">2018</span>,</span>
<span>  lon       <span class="op">=</span> <span class="fl">3.5958</span>,</span>
<span>  lat       <span class="op">=</span> <span class="fl">43.7414</span>,</span>
<span>  verbose   <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="co">#settings  = list(correct_bias = "worldclim", dir_bias = "~/data/worldclim")</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">df_watch</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cru-ts">CRU TS<a class="anchor" aria-label="anchor" href="#cru-ts"></a>
</h3>
<p>As above, let’s extract CRU data for the location corresponding to
FLUXNET site ‘FR-Pue’ (lon = 8.365, lat = 47.4781). The argument
<code>getvars</code> works the same way as for WATCH-WFDEI: is a vector
of ingestr-standard variable names to be read. ingestr automatically
reads from the respective files with CRU variable names. Available
variables are:
<code>"tmin", "tmax", "temp", "vpd", "ccov", "wetd"</code>.</p>
<p>Note that we’re using <code>tmx</code> (the daily maximum
temperature). This extracts monthly data from the CRU TS data.
Interpolation to daily values is done using a weather generator for
daily precipitation (given monthly total precipitation and number of wet
days in each month), and a polynomial that conserves monthly means for
all other variables.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_cru</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span><span class="op">(</span></span>
<span>  sitename  <span class="op">=</span> <span class="st">"FR-Pue"</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"cru"</span>,</span>
<span>  getvars   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tmin"</span>, <span class="st">"tmax"</span><span class="op">)</span>,</span>
<span>  dir       <span class="op">=</span> <span class="st">"~/data/cru/ts_4.05/"</span>,</span>
<span>  timescale <span class="op">=</span> <span class="st">"d"</span>,</span>
<span>  year_start <span class="op">=</span> <span class="fl">2007</span>,</span>
<span>  year_end  <span class="op">=</span> <span class="fl">2007</span>,</span>
<span>  lon       <span class="op">=</span> <span class="fl">3.5958</span>,</span>
<span>  lat       <span class="op">=</span> <span class="fl">43.7414</span>,</span>
<span>  verbose   <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">df_cru</span></span></code></pre></div>
<p>We can compare the temperature recorded at the site and the
temperature data extracted from WATCH-WFDEI and CRU.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df_fluxnet</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>temp_fluxnet <span class="op">=</span> <span class="va">temp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="va">df_watch</span>, temp_watch <span class="op">=</span> <span class="va">temp</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sitename"</span>, <span class="st">"date"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="va">df_cru</span>, temp_min_cru <span class="op">=</span> <span class="va">tmin</span>, temp_max_cru <span class="op">=</span> <span class="va">tmax</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sitename"</span>, <span class="st">"date"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">temp_fluxnet</span>, <span class="va">temp_watch</span>, <span class="va">temp_min_cru</span>, <span class="va">temp_max_cru</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"source"</span>, values_to <span class="op">=</span> <span class="st">"temp"</span>, names_prefix <span class="op">=</span> <span class="st">"temp_"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">temp</span>, color <span class="op">=</span> <span class="va">source</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Looks sweet.</p>
</div>
<div class="section level3">
<h3 id="wfde5">WFDE5<a class="anchor" aria-label="anchor" href="#wfde5"></a>
</h3>
<p>Let’s have a look at the hourly climate data from the <a href="https://doi.org/10.5194/essd-12-2097-2020" class="external-link">WFDE5 dataset</a>.
Again, let’s extract meth data for the location corresponding to FLUXNET
site ‘FR-Pue’ (lon = 8.365, lat = 47.4781). All input arguments work the
same way as described above for WATCH-WFDEI and CRU TS. Note that we are
setting <code>timescale = "h"</code> here to obtain an hourly dataframe.
Available variables are:
<code>"temp", "ppfd", "vpd", "patm", "prec", "wind", "swin", "lwin"</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wfde5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span><span class="op">(</span></span>
<span>  sitename  <span class="op">=</span> <span class="st">"FR-Pue"</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"wfde5"</span>,</span>
<span>  getvars   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"temp"</span><span class="op">)</span>,</span>
<span>  dir       <span class="op">=</span> <span class="st">"~/data/wfde5/"</span>,</span>
<span>  timescale <span class="op">=</span> <span class="st">"h"</span>,</span>
<span>  year_start <span class="op">=</span> <span class="fl">2007</span>,</span>
<span>  year_end  <span class="op">=</span> <span class="fl">2007</span>,</span>
<span>  lon       <span class="op">=</span> <span class="fl">3.5958</span>,</span>
<span>  lat       <span class="op">=</span> <span class="fl">43.7414</span>,</span>
<span>  verbose   <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  settings  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>correct_bias <span class="op">=</span> <span class="st">"worldclim"</span>, dir_bias <span class="op">=</span> <span class="st">"~/data/worldclim"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">df_wfde5</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="modis-lp-daac">MODIS LP DAAC<a class="anchor" aria-label="anchor" href="#modis-lp-daac"></a>
</h3>
<p>This uses the <a href="https://docs.ropensci.org/MODISTools/" class="external-link">MODISTools</a> R package
making its interface consistent with ingestr. Settings can be specified
and passed on using the <code>settings</code> argument. To facilitate
the selection of data products and bands to be downloaded, you may use
the function <code>get_settings_modis)</code> which defines defaults for
different data bundles
(<code>c("modis_fpar", "modis_ndvi", "modis_evi")</code> are
available).</p>
<ul>
<li>
<code>"modis_fpar"</code>: MODIS collection 6, MCD15A3H, band
<code>Fpar_500m</code>
</li>
<li>
<code>"modis_lai"</code>: MODIS collection 6, MCD15A3H, band
<code>Lai_500m</code>
</li>
<li>
<code>"modis_evi"</code>: MODIS collection 6, MOD13Q1, band
<code>250m_16_days_EVI</code>
</li>
<li>
<code>"modis_ndvi"</code>: MODIS collection 6, MOD13Q1, band
<code>250m_16_days_NDVI</code>
</li>
<li>
<code>"modis_refl"</code>: MODIS/Terra+Aqua Nadir BRDF-Adjusted
Reflectance (NBAR) Daily L3 Global 500 m SIN Grid, all bands</li>
<li>
<code>"modis_lst"</code>: MODIS/Terra Land Surface
Temperature/Emissivity 8-Day L3 Global 1 km SIN Grid (MOD11A2 v006)</li>
</ul>
<p>The filtering criteria are hard-coded specifically for each product,
using its respective quality control information (see function
<code><a href="../reference/gapfill_interpol.html">gapfill_interpol()</a></code> in
<code>R/ingest_modis_bysite.R</code>). For more information on the
settings do <code><a href="../reference/get_settings_modis.html">?get_settings_modis</a></code>.</p>
<p>The following example is for downloading MODIS FPAR MCD15A3H data.
Note the specification of the argument <code>network = "FLUXNET"</code>.
This triggers the download of prepared subsets aligning with site
locations for different networks (see <a href="https://modis.ornl.gov/sites/" class="external-link">here</a>) which is much faster than
the download of data for arbitrary locations. This also makes the
specification of longitude and latitude values in the call to
<code><a href="../reference/ingest_bysite.html">ingest_bysite()</a></code> obsolete and downloads a scene of 17 x 17
pixels. Using <code>n_focal</code> in <code><a href="../reference/get_settings_modis.html">get_settings_modis()</a></code>
subsets the scene to central pixels where the value provided for
<code>n_focal</code> is the distance in number of pixels away from the
center pixel to be taken for averaging. This is done the same way for
the network and non-network ingest options.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings_modis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_settings_modis.html">get_settings_modis</a></span><span class="op">(</span></span>
<span>  bundle            <span class="op">=</span> <span class="st">"modis_fpar"</span>,</span>
<span>  data_path         <span class="op">=</span> <span class="st">"~/data/modis_subsets/"</span>,</span>
<span>  method_interpol   <span class="op">=</span> <span class="st">"loess"</span>,</span>
<span>  keep              <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  overwrite_raw     <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  overwrite_interpol<span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_focal           <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  network           <span class="op">=</span> <span class="st">"FLUXNET"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>This can now be used to download the data to the directory specified
by argument <code>data_path</code> of function
<code><a href="../reference/get_settings_gee.html">get_settings_gee()</a></code>. The data downloaded through MODISTools
is then stored in <code>&lt;data_path&gt;/raw/</code>. When calling the
functions <code><a href="../reference/ingest.html">ingest()</a></code> or <code><a href="../reference/ingest_bysite.html">ingest_bysite()</a></code> with the
setting <code>overwrite_raw = FALSE</code>, the raw data file is read
and not re-downloaded if available locally. Raw data contains
information only for dates where MODIS data is provided.
<code><a href="../reference/ingest.html">ingest()</a></code> and <code><a href="../reference/ingest_bysite.html">ingest_bysite()</a></code> interpolate to
daily values following the setting <code>method_interpol</code>.</p>
<p>Note also that downloaded raw data are cutouts including pixels of 1
km within the focal point indicated by the site longitude and latitude
(using arguments <code>km_lr = 1.0</code> and <code>km_ab = 1.0</code>
in the <code><a href="https://rdrr.io/pkg/MODISTools/man/mt_subset.html" class="external-link">MODISTools::mt_subset()</a></code> call). This is hard-coded in
ingestr. To select a smaller radius of pixels around the focal point
included for taking the mean, set the setting <code>n_focal</code> to an
integer (0:N), with 0 selecting only the single centre pixel in which
the site is located, N=1 for including one pixel around the centre (nine
in total), N=2 for 25 in total etc.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_modis_fpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span><span class="op">(</span></span>
<span>  sitename  <span class="op">=</span> <span class="st">"CH-Lae"</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"modis"</span>,</span>
<span>  year_start<span class="op">=</span> <span class="fl">2018</span>,</span>
<span>  year_end  <span class="op">=</span> <span class="fl">2019</span>,</span>
<span>  <span class="co"># lon       = 8.36439,   # not needed when network = "FLUXNET"</span></span>
<span>  <span class="co"># lat       = 47.47833,  # not needed when network = "FLUXNET"</span></span>
<span>  settings  <span class="op">=</span> <span class="va">settings_modis</span>,</span>
<span>  verbose   <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Plot this data.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_fapar_ingestr_bysite</span><span class="op">(</span></span>
<span>  <span class="va">df_modis_fpar</span>, </span>
<span>  <span class="va">settings_modis</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="google-earth-engine">Google Earth Engine<a class="anchor" aria-label="anchor" href="#google-earth-engine"></a>
</h3>
<p>The library <code>gee_subset</code> by Koen Hufkens can be downloaded
from this <a href="https://khufkens.github.io/gee_subset/" class="external-link">link</a> and
used to extract data directly from Google Earth Engine. Note that this
requires the following programmes to be available:</p>
<ul>
<li>git: You can use <a href="https://brew.sh/" class="external-link">Homebrew</a> to
installing git by entering in your terminal:
<code>brew install git</code>.</li>
<li><a href="https://www.python.org/" class="external-link">python</a></li>
<li>The Python Pandas library</li>
</ul>
<p>Then, carry out the follwing steps:</p>
<ul>
<li>In your terminal, change to where you want to have the repository.
In this example, we’re cloning it into our home directory:</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>cd <span class="sc">~</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>git clone https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>khufkens<span class="sc">/</span>google_earth_engine_subsets.git</span></code></pre></div>
<p>To get access to using the Google Earth Engine API (required to use
the <code>gee_subset</code> library), carry out the following steps in
your terminal. This follows steps described <a href="https://github.com/google/earthengine-api/issues/27" class="external-link">here</a>.</p>
<ol style="list-style-type: decimal">
<li>Install google API Python client</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>sudo pip install <span class="sc">--</span>upgrade google<span class="sc">-</span>api<span class="sc">-</span>python<span class="sc">-</span>client</span></code></pre></div>
<p>I had an error and first had to do this here following <a href="https://github.com/pypa/pip/issues/3165" class="external-link">this link</a>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>sudo pip install <span class="sc">--</span>ignore<span class="sc">-</span>installed six</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Install pyCrypto</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>sudo pip install pyCrypto <span class="sc">--</span>upgrade</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Install Python GEE API</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>sudo pip install earthengine<span class="sc">-</span>api</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Run authentification for GEE</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>earthengine authenticate</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Finally, try if it works. This shouldn’t return an error:</li>
</ol>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>python <span class="sc">-</span>c <span class="st">"import ee; ee.Initialize()"</span></span></code></pre></div>
<div class="section level4">
<h4 id="modis-fpar">MODIS FPAR<a class="anchor" aria-label="anchor" href="#modis-fpar"></a>
</h4>
<p>To facilitate the selection of data products and bands to be
downloaded, you may use the function <code><a href="../reference/get_settings_gee.html">get_settings_gee()</a></code>
which defines defaults for different data bundles
(<code>c("modis_fpar", "modis_evi", "modis_lai", "modis_gpp")</code> are
available).</p>
<ul>
<li>
<code>"modis_fpar"</code>: MODIS/006/MCD15A3H, band Fpar</li>
<li>
<code>"modis_evi"</code>: MODIS/006/MOD13Q1, band EVI</li>
<li>
<code>"modis_lai"</code>: MOD15A2, band <code>Lai_1km</code>
</li>
<li>
<code>"modis_gpp"</code>: MODIS/006/MOD17A2H, band Gpp</li>
</ul>
<p>The following example is for downloading MODIS FPAR data.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings_gee</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_settings_gee.html">get_settings_gee</a></span><span class="op">(</span></span>
<span>  bundle            <span class="op">=</span> <span class="st">"modis_fpar"</span>,</span>
<span>  python_path       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"which python"</span>, intern <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  gee_path          <span class="op">=</span> <span class="st">"~/google_earth_engine_subsets/gee_subset/"</span>,</span>
<span>  data_path         <span class="op">=</span> <span class="st">"~/data/gee_subsets/"</span>,</span>
<span>  method_interpol   <span class="op">=</span> <span class="st">"linear"</span>,</span>
<span>  keep              <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  overwrite_raw     <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  overwrite_interpol<span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>This can now be used to download the data to the directory specified
by argument <code>data_path</code> of function
<code><a href="../reference/get_settings_gee.html">get_settings_gee()</a></code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_gee_modis_fpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span><span class="op">(</span></span>
<span>  sitename  <span class="op">=</span> <span class="st">"CH-Lae"</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"gee"</span>,</span>
<span>  year_start<span class="op">=</span> <span class="fl">2009</span>,</span>
<span>  year_end  <span class="op">=</span> <span class="fl">2010</span>,</span>
<span>  lon       <span class="op">=</span> <span class="fl">8.36439</span>,</span>
<span>  lat       <span class="op">=</span> <span class="fl">47.47833</span>,</span>
<span>  settings  <span class="op">=</span> <span class="va">settings_gee</span>,</span>
<span>  verbose   <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="co2">CO2<a class="anchor" aria-label="anchor" href="#co2"></a>
</h3>
<p>Ingesting CO2 data is particularly simple. We can safely assume it’s
well mixed in the atmosphere (independent of site location), and we can
use a annual mean value for all days in respective years, and use the
same value for all sites. Using the R package <a href="https://github.com/bczernecki/climate" class="external-link">climate</a>, we can load
CO2 data from Mauna Loa directly into R. This is downloading data from
<a href="ftp://aftp.cmdl.noaa.gov/products/trends/co2/co2_mm_mlo.txt" class="uri">ftp://aftp.cmdl.noaa.gov/products/trends/co2/co2_mm_mlo.txt</a>.
Here, <code><a href="../reference/ingest.html">ingest()</a></code> is a wrapper for the function
<code><a href="https://rdrr.io/pkg/climate/man/meteo_noaa_co2.html" class="external-link">climate::meteo_noaa_co2()</a></code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_co2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span><span class="op">(</span></span>
<span>  sitename  <span class="op">=</span> <span class="st">"CH-Lae"</span>,</span>
<span>  source  <span class="op">=</span> <span class="st">"co2_mlo"</span>,</span>
<span>  year_start<span class="op">=</span> <span class="fl">2007</span>,</span>
<span>  year_end  <span class="op">=</span> <span class="fl">2014</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Argument <code>dir</code> can be provided here, too. In that case,
CO2 data is written (after download if it’s not yet available) and read
to/from a file located at <code>&lt;dir&gt;/df_co2_mlo.csv</code>.</p>
<p>More info about the <strong>climate</strong> package and the data can
be obtained <a href="https://www.esrl.noaa.gov/gmd/ccgg/trends/data.html" class="external-link">here</a> and
by:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="fu">climate</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/climate/man/meteo_noaa_co2.html" class="external-link">meteo_noaa_co2</a></span></span></code></pre></div>
<p><strong>THE FOLLOWING IS UNDER CONSTRUCTION. MAKE READABLE FOR FILE
AVAILABLE HERE: <a href="http://www.pik-potsdam.de/~mmalte/rcps/" class="external-link uri">http://www.pik-potsdam.de/~mmalte/rcps/</a></strong></p>
<p>Mauna Loa CO2 is not available for years before 1958. Alternative CO2
data is from CMIP standard forcing with merged time series from
atmospheric measurements and ice core reconstructions. This can be
selected with <code>source = "co2_cmip</code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_co2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span><span class="op">(</span></span>
<span>  sitename  <span class="op">=</span> <span class="st">"CH-Lae"</span>,</span>
<span>  source  <span class="op">=</span> <span class="st">"co2_cmip"</span>,</span>
<span>  year_start<span class="op">=</span> <span class="fl">2007</span>,</span>
<span>  year_end  <span class="op">=</span> <span class="fl">2014</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  dir <span class="op">=</span> <span class="st">"~/data/co2"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="hwsd">HWSD<a class="anchor" aria-label="anchor" href="#hwsd"></a>
</h3>
<p>Four steps are required before you can use
<code><a href="../reference/ingest_bysite.html">ingest_bysite()</a></code> to get <a href="https://webarchive.iiasa.ac.at/Research/LUC/External-World-soil-database/HTML/" class="external-link">HWSD</a>
data:</p>
<ol style="list-style-type: decimal">
<li>The the modified version of David LeBauer’s <a href="https://github.com/dlebauer/rhwsd" class="external-link">rhwsd</a> R package. The
modified version can be installed by:</li>
</ol>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="va">devtools</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"stineb/rhwsd"</span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Install additionally required packages: DBI and RSQLite.</li>
</ol>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list.of.packages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DBI"</span>, <span class="st">"RSQLite"</span><span class="op">)</span></span>
<span><span class="va">new.packages</span> <span class="op">&lt;-</span> <span class="va">list.of.packages</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">list.of.packages</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span>,<span class="st">"Package"</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">new.packages</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="va">new.packages</span><span class="op">)</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Download the HWSD data file <a href="http://webarchive.iiasa.ac.at/Research/LUC/External-World-soil-database/HWSD_Data/HWSD_RASTER.zip" class="external-link">HWSD_RASTER.zip</a>
and extract.</li>
<li>Move the extracted files to a local directory and adjust the file
path in the <code>settings</code> argument accordingly (in this example:
<code>"~/data/hwsd/HWSD_RASTER/hwsd.bil"</code>).</li>
</ol>
<p>Then, use similarly to above, with providing the path to the
downloaded file with the <code>settings</code> argument:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_hwsd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span><span class="op">(</span></span>
<span>  sitename  <span class="op">=</span> <span class="st">"CH-Lae"</span>,</span>
<span>  source  <span class="op">=</span> <span class="st">"hwsd"</span>,</span>
<span>  lon     <span class="op">=</span> <span class="fl">8.36439</span>,</span>
<span>  lat     <span class="op">=</span> <span class="fl">47.47833</span>,</span>
<span>  settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fil <span class="op">=</span> <span class="st">"~/data/hwsd/HWSD_RASTER/hwsd.bil"</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="nitrogen-deposition">Nitrogen deposition<a class="anchor" aria-label="anchor" href="#nitrogen-deposition"></a>
</h3>
<p>This reads nitrogen deposition from global annual maps by Lamarque et
al. (2011). This provides annual data separately for NHx and NOy in gN
m<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mrow><mo>−</mo><mn>2</mn></mrow></msup><annotation encoding="application/x-tex">^{-2}</annotation></semantics></math>
yr<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><annotation encoding="application/x-tex">^{-1}</annotation></semantics></math>
from a global map provided at half-degree resolution and covering years
1860-2009.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_ndep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span><span class="op">(</span></span>
<span>  sitename  <span class="op">=</span> <span class="st">"CH-Lae"</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"ndep"</span>,</span>
<span>  lon       <span class="op">=</span> <span class="fl">8.36439</span>,</span>
<span>  lat       <span class="op">=</span> <span class="fl">47.47833</span>,</span>
<span>  year_start<span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  year_end  <span class="op">=</span> <span class="fl">2009</span>,</span>
<span>  timescale <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  dir       <span class="op">=</span> <span class="st">"~/data/ndep_lamarque/"</span>,</span>
<span>  verbose   <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="soilgrids">SoilGrids<a class="anchor" aria-label="anchor" href="#soilgrids"></a>
</h3>
<p>Point extractions from <a href="https://soilgrids.org/" class="external-link">SoilGrids</a>
layers are implemented following <a href="https://git.wur.nl/isric/soilgrids/soilgrids.notebooks/-/blob/master/markdown/xy_info_from_R.md" class="external-link">this</a>
and are provided through <a href="https://www.isric.org/" class="external-link">ISRIC</a>.</p>
<p>Available layers and variable naming conventions are described <a href="https://www.isric.org/explore/soilgrids/faq-soilgrids#What_do_the_filename_codes_mean" class="external-link">here</a>.
Which variable is to be extracted and for which soil depth layer can be
specified in the settings, a list returned by the function call
<code><a href="../reference/get_settings_soilgrids.html">get_settings_soilgrids()</a></code>.</p>
<p>Available variables are described in the table below. Conversion
facto are applied by ingestr. Hence, the returned data is in units as
described in the table below as “Conventional units”.</p>
<table style="width:98%;" class="table">
<colgroup>
<col width="7%">
<col width="54%">
<col width="10%">
<col width="12%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th>Name</th>
<th>Description</th>
<th>Mapped units</th>
<th>Conversion factor</th>
<th>Conventional units</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>bdod</td>
<td>Bulk density of the fine earth fraction</td>
<td>cg/cm³</td>
<td>100</td>
<td>kg/dm³</td>
</tr>
<tr class="even">
<td>cec</td>
<td>Cation Exchange Capacity of the soil</td>
<td>mmol(c)/kg</td>
<td>10</td>
<td>cmol(c)/kg</td>
</tr>
<tr class="odd">
<td>cfvo</td>
<td>Volumetric fraction of coarse fragments (&gt; 2 mm)</td>
<td>cm3/dm3 (vol‰)</td>
<td>10</td>
<td>cm3/100cm3 (vol%)</td>
</tr>
<tr class="even">
<td>clay</td>
<td>Proportion of clay particles (&lt; 0.002 mm) in the fine earth
fraction</td>
<td>g/kg</td>
<td>10</td>
<td>g/100g (%)</td>
</tr>
<tr class="odd">
<td>nitrogen</td>
<td>Total nitrogen (N)</td>
<td>cg/kg</td>
<td>100</td>
<td>g/kg</td>
</tr>
<tr class="even">
<td>phh2o</td>
<td>Soil pH</td>
<td>pHx10</td>
<td>10</td>
<td>pH</td>
</tr>
<tr class="odd">
<td>sand</td>
<td>Proportion of sand particles (&gt; 0.05 mm) in the fine earth
fraction</td>
<td>g/kg</td>
<td>10</td>
<td>g/100g (%)</td>
</tr>
<tr class="even">
<td>silt</td>
<td>Proportion of silt particles (≥ 0.002 mm and ≤ 0.05 mm) in the fine
earth fraction</td>
<td>g/kg</td>
<td>10</td>
<td>g/100g (%)</td>
</tr>
<tr class="odd">
<td>soc</td>
<td>Soil organic carbon content in the fine earth fraction</td>
<td>dg/kg</td>
<td>10</td>
<td>g/kg</td>
</tr>
<tr class="even">
<td>ocd</td>
<td>Organic carbon density</td>
<td>hg/dm³</td>
<td>10</td>
<td>kg/dm³</td>
</tr>
<tr class="odd">
<td>ocs</td>
<td>Organic carbon stocks</td>
<td>t/ha</td>
<td>10</td>
<td>kg/m²</td>
</tr>
</tbody>
</table>
<p>Data is available for the following six layers.</p>
<table class="table">
<thead><tr class="header">
<th>Layer</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Top depth (cm)</td>
<td>0</td>
<td>5</td>
<td>15</td>
<td>30</td>
<td>60</td>
<td>100</td>
</tr>
<tr class="even">
<td>Bottom depth (cm)</td>
<td>5</td>
<td>15</td>
<td>30</td>
<td>60</td>
<td>100</td>
<td>200</td>
</tr>
</tbody>
</table>
<p>The specify which data is to be ingested define the settings using
the function <code><a href="../reference/get_settings_soilgrids.html">get_settings_soilgrids()</a></code>, and provide standard
variable names as a vector of character strings for argument
<code>varnam</code>, and layers as a vector of integers for argument
<code>layer</code>. For example:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings_soilgrids</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_settings_soilgrids.html">get_settings_soilgrids</a></span><span class="op">(</span>varnam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nitrogen"</span>, <span class="st">"cec"</span><span class="op">)</span>, layer <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>The ingested data is then averaged across specified layers, weighted
with respective layer depths.</p>
<p>Now, the data can be ingested.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_soilgrids</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span><span class="op">(</span></span>
<span>  sitename  <span class="op">=</span> <span class="st">"CH-Lae"</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"soilgrids"</span>,</span>
<span>  lon       <span class="op">=</span> <span class="fl">8.36439</span>,</span>
<span>  lat       <span class="op">=</span> <span class="fl">47.47833</span>,</span>
<span>  settings  <span class="op">=</span> <span class="va">settings_soilgrids</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>This returns a data frame with a nested column <code>data</code>
which contains actually just a 1 x 1 tibble. This is to be consistent
with other ingest options. You may prefer to have a normal flat data
frame. Just do:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_soilgrids</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="isric-wise30sec">ISRIC WISE30sec<a class="anchor" aria-label="anchor" href="#isric-wise30sec"></a>
</h3>
<p>This reads from local files. Download them from ISRIC <a href="https://data.isric.org/geonetwork/srv/eng/catalog.search#/metadata/dc7b283a-8f19-45e1-aaed-e9bd515119bc" class="external-link">here</a>.</p>
<p>Point extraction from the global gridded WISE30sec data product (<a href="http://dx.doi.org/10.1016/j.geoderma.2016.01.034" class="external-link">Batjes et al.,
2016</a>) can be done for a set of variables and soil layers by
specifying the ingest demand in the settings. ingestr returns data as a
mean across available map units for selected location (pixel), weighted
by the fractional coverage of map units for this pixel. The table below
describes available variables (info based on <a href="https://www.isric.org/documents/document-type/isric-report-201501-world-soil-property-estimates-broad-scale-modelling" class="external-link">ISRIC
Report 2015/01</a>).</p>
<table class="table">
<colgroup>
<col width="10%">
<col width="89%">
</colgroup>
<thead><tr class="header">
<th>Name</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>CFRAG</td>
<td>Coarse fragments (vol. % &gt; 2mm), mean</td>
</tr>
<tr class="even">
<td>SDTO</td>
<td>Sand (mass %), mean</td>
</tr>
<tr class="odd">
<td>STPC</td>
<td>Silt (mass %)</td>
</tr>
<tr class="even">
<td>CLPC</td>
<td>Clay (mass %)</td>
</tr>
<tr class="odd">
<td>PSCL</td>
<td>Texture class (SOTER conventions)</td>
</tr>
<tr class="even">
<td>BULK</td>
<td>Bulk density (kg dm-3, g cm-3)</td>
</tr>
<tr class="odd">
<td>TAWC</td>
<td>Available water capacity (cm m-1, -33 to -1500 kPa, conform USDA
standards) Standard deviation for above</td>
</tr>
<tr class="even">
<td>CECS</td>
<td>Cation exchange capacity (cmol kg-1) of fine earth fraction</td>
</tr>
<tr class="odd">
<td>BSAT</td>
<td>Base saturation as percentage of CECsoil</td>
</tr>
<tr class="even">
<td>ESP</td>
<td>Exchangeable sodium percentage</td>
</tr>
<tr class="odd">
<td>CECc</td>
<td>CECclay, corrected for contribution of organic matter (cmol
kg-1)</td>
</tr>
<tr class="even">
<td>PHAQ</td>
<td>pH measured in water</td>
</tr>
<tr class="odd">
<td>TCEQ</td>
<td>Total carbonate equivalent (g C kg-1)</td>
</tr>
<tr class="even">
<td>GYPS</td>
<td>Gypsum content (g kg-1)</td>
</tr>
<tr class="odd">
<td>ELCO</td>
<td>Electrical conductivity (dS m-1)</td>
</tr>
<tr class="even">
<td>ORGC</td>
<td>Organic carbon content (g kg-1)</td>
</tr>
<tr class="odd">
<td>TOTN</td>
<td>Total nitrogen (g kg-1)</td>
</tr>
<tr class="even">
<td>CNrt</td>
<td>C/N ratio</td>
</tr>
<tr class="odd">
<td>ECEC</td>
<td>Effective CEC (cmol kg-1)</td>
</tr>
<tr class="even">
<td>ALSA</td>
<td>Aluminum saturation (as % of ECEC)</td>
</tr>
</tbody>
</table>
<p>By default, data is extracted for the top layer only. Data is
provided for the following seven layers (depths in cm).</p>
<table class="table">
<thead><tr class="header">
<th>Layer</th>
<th>Top depth</th>
<th>Bottom depth</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0</td>
<td>20</td>
</tr>
<tr class="even">
<td>2</td>
<td>20</td>
<td>40</td>
</tr>
<tr class="odd">
<td>3</td>
<td>40</td>
<td>60</td>
</tr>
<tr class="even">
<td>4</td>
<td>60</td>
<td>80</td>
</tr>
<tr class="odd">
<td>5</td>
<td>80</td>
<td>1000</td>
</tr>
<tr class="even">
<td>6</td>
<td>100</td>
<td>150</td>
</tr>
<tr class="odd">
<td>7</td>
<td>150</td>
<td>200</td>
</tr>
</tbody>
</table>
<p>The following settings specify data extraction for the C:N ratio of
the top three layers. The returned value is the mean across selected
soil layers, weighted by the respective layer’s depth. <code>dir</code>
specifies the path to the downloaded data bundle. Don’t change the
structure of it. ingestr reads from two files:
<code>&lt;dir&gt;/GISfiles/wise30sec_fin</code> and
<code>&lt;dir&gt;/Interchangeable_format/HW30s_FULL.txt</code>.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings_wise</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_settings_wise.html">get_settings_wise</a></span><span class="op">(</span>varnam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CNrt"</span><span class="op">)</span>, layer <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p>Now, the data can be ingested.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wise</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span><span class="op">(</span></span>
<span>  sitename  <span class="op">=</span> <span class="st">"CH-Lae"</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"wise"</span>,</span>
<span>  lon       <span class="op">=</span> <span class="fl">8.36439</span>,</span>
<span>  lat       <span class="op">=</span> <span class="fl">47.47833</span>,</span>
<span>  settings  <span class="op">=</span> <span class="va">settings_wise</span>,</span>
<span>  dir       <span class="op">=</span> <span class="st">"~/data/soil/wise"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="gsde-soil">GSDE Soil<a class="anchor" aria-label="anchor" href="#gsde-soil"></a>
</h3>
<p>Global Soil Dataset for use in Earth System Models (GSDE) by <a href="https://doi.org/10.1002/2013MS000293" class="external-link">Shangguan et al. 2014</a>,
obtained from <a href="http://globalchange.bnu.edu.cn/research/soilwd.jsp" class="external-link">here</a>.
Available variables are given in the table below.</p>
<table style="width:98%;" class="table">
<colgroup>
<col width="14%">
<col width="46%">
<col width="18%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th>No.</th>
<th>Attribute</th>
<th>units</th>
<th>variable name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>total carbon</td>
<td>%of weight</td>
<td>TC</td>
</tr>
<tr class="even">
<td>2</td>
<td>organic carbon</td>
<td>%of weight</td>
<td>OC</td>
</tr>
<tr class="odd">
<td>3</td>
<td>total N</td>
<td>%of weight</td>
<td>TN</td>
</tr>
<tr class="even">
<td>7</td>
<td>pH(H2O)</td>
<td></td>
<td>PHH2O</td>
</tr>
<tr class="odd">
<td>8</td>
<td>pH(KCl)</td>
<td></td>
<td>PHK</td>
</tr>
<tr class="even">
<td>9</td>
<td>pH(CaCl2)</td>
<td></td>
<td>PHCA</td>
</tr>
<tr class="odd">
<td>15</td>
<td>Exchangeable aluminum</td>
<td>cmol/kg</td>
<td>EXA</td>
</tr>
<tr class="even">
<td>27</td>
<td>The amount of P using the Bray1 method</td>
<td>ppm of weight</td>
<td>PBR</td>
</tr>
<tr class="odd">
<td>28</td>
<td>The amount of P by Olsen method</td>
<td>ppm of weight</td>
<td>POL</td>
</tr>
<tr class="even">
<td>29</td>
<td>P retention by New Zealand method</td>
<td>% of weight</td>
<td>PNZ</td>
</tr>
<tr class="odd">
<td>30</td>
<td>The amount of water soluble P</td>
<td>ppm of weight</td>
<td>PHO</td>
</tr>
<tr class="even">
<td>31</td>
<td>The amount of P by Mehlich method</td>
<td>ppm of weight</td>
<td>PMEH</td>
</tr>
<tr class="odd">
<td>33</td>
<td>Total P</td>
<td>% of weight</td>
<td>TP</td>
</tr>
<tr class="even">
<td>34</td>
<td>Total potassium</td>
<td>% of weight</td>
<td>TK</td>
</tr>
</tbody>
</table>
<p>The 8 layers are:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_layers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>layer <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, bottom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4.5</span>, <span class="fl">9.1</span>, <span class="fl">16.6</span>, <span class="fl">28.9</span>, <span class="fl">49.3</span>, <span class="fl">82.9</span>, <span class="fl">138.3</span>, <span class="fl">229.6</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>top <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">bottom</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>top <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">top</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">top</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_layers</span></span></code></pre></div>
<p>Specify the settings directly as a list with elements
<code>varnam</code> (a vector of character strings specifying the
variables as defined in the table above), and <code>layer</code> (a
vector of integers specifying the layers over which a depth-weighted
average is taken).</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings_gsde</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>varnam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TN"</span>, <span class="st">"PBR"</span>, <span class="st">"PHH2O"</span><span class="op">)</span>, layer <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>Now, the data can be ingested.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_gsde</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span><span class="op">(</span></span>
<span>  sitename  <span class="op">=</span> <span class="st">"CH-Lae"</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"gsde"</span>,</span>
<span>  lon       <span class="op">=</span> <span class="fl">8.36439</span>,</span>
<span>  lat       <span class="op">=</span> <span class="fl">47.47833</span>,</span>
<span>  settings  <span class="op">=</span> <span class="va">settings_gsde</span>,</span>
<span>  dir       <span class="op">=</span> <span class="st">"~/data/soil/shangguan"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>And data is returned with variables along columns inside a nested
column <code>data</code>, and sites along rows (as for all ingestr).
Make it flat by:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_gsde</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="worldclim">WorldClim<a class="anchor" aria-label="anchor" href="#worldclim"></a>
</h3>
<p>This ingests Worldclim monthly climatology (averaged over 1970-2000)
at 30 seconds spatial resolution by <a href="https://doi.org/10.1002/joc.5086" class="external-link">Fick &amp; Hijmans, 2017</a>,
obtained <a href="https://www.worldclim.org/data/worldclim21.html" class="external-link">here</a>.
Available variables are:</p>
<table style="width:99%;" class="table">
<colgroup>
<col width="13%">
<col width="73%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th>Variable name</th>
<th>Description</th>
<th>Units</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>bio</td>
<td>Bioclimatic variables (description <a href="https://www.worldclim.org/data/bioclim.html" class="external-link">here</a>)</td>
<td></td>
</tr>
<tr class="even">
<td>tmin</td>
<td>Minimum temperature</td>
<td>°C</td>
</tr>
<tr class="odd">
<td>tmax</td>
<td>Maximum temperature</td>
<td>°C</td>
</tr>
<tr class="even">
<td>tavg</td>
<td>Average temperature</td>
<td>°C</td>
</tr>
<tr class="odd">
<td>prec</td>
<td>Precipitation</td>
<td>mm</td>
</tr>
<tr class="even">
<td>srad</td>
<td>Solar radiation</td>
<td>kJ m-2 day-1</td>
</tr>
<tr class="odd">
<td>wind</td>
<td>Wind speed</td>
<td>m s-1</td>
</tr>
<tr class="even">
<td>vapr</td>
<td>Water vapour pressure</td>
<td>kPa</td>
</tr>
</tbody>
</table>
<p>Specify the settings directly as a list with elements
<code>varnam</code> (a vector of character strings specifying the
variables as defined in the table above), and <code>layer</code> (a
vector of integers specifying the layers over which a depth-weighted
average is taken).</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings_worldclim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>varnam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now, the data can be ingested.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_worldclim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span><span class="op">(</span></span>
<span>  sitename  <span class="op">=</span> <span class="st">"CH-Lae"</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"worldclim"</span>,</span>
<span>  lon       <span class="op">=</span> <span class="fl">8.36439</span>,</span>
<span>  lat       <span class="op">=</span> <span class="fl">47.47833</span>,</span>
<span>  settings  <span class="op">=</span> <span class="va">settings_worldclim</span>,</span>
<span>  dir       <span class="op">=</span> <span class="st">"/data/archive/worldclim_fick_2017/data"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>And for Flat-Earthers:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_worldclim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="examples-for-a-site-ensemble">Examples for a site ensemble<a class="anchor" aria-label="anchor" href="#examples-for-a-site-ensemble"></a>
</h2>
<p>To collect data from an ensemble of sites, we have to define a meta
data frame, here called <code>siteinfo</code>, with rows for each site
and columns <code>lon</code> for longitude, <code>lat</code> for
latitude, <code>date_start</code> and <code>date_end</code> for required
dates (Dates are objects returned by a <code><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">lubridate::ymd()</a></code>
function call - this stands for year-month-day). The function
<code><a href="../reference/ingest.html">ingest()</a></code> can then be used to collect all site-level data as
a nested data frame corresponding to the metadata <code>siteinfo</code>
with an added column named <code>data</code> where the time series of
ingested data is nested inside.</p>
<p>Note that extracting for an ensemble of sites at once is more
efficient for data types that are global files (WATCH-WFDEI, and CRU).
In this case, the <code>raster</code> package can be used to efficiently
ingest data.</p>
<p>First, define a list of sites and get site meta information. The
required meta information is provided by the exported data frame
<code>siteinfo</code> (it comes as part of the ingestr package). This
file is created as described in (and using code from) <a href="https://github.com/stineb/metainfo_fluxnet2015" class="external-link">metainfo_fluxnet2015</a>.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mysites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BE-Vie"</span>, <span class="st">"DE-Tha"</span>, <span class="st">"DK-Sor"</span>, <span class="st">"FI-Hyy"</span>, <span class="st">"IT-Col"</span>, <span class="st">"NL-Loo"</span>, <span class="st">"US-MMS"</span>, <span class="st">"US-WCr"</span>, <span class="st">"US-UMB"</span>, <span class="st">"US-Syv"</span>, <span class="st">"DE-Hai"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">siteinfo</span> <span class="op">&lt;-</span> <span class="fu">ingestr</span><span class="fu">::</span><span class="va"><a href="../reference/siteinfo_fluxnet2015.html">siteinfo_fluxnet2015</a></span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sitename</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">mysites</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>date_start <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">year_start</span>, <span class="st">"-01-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>date_end <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">year_end</span>, <span class="st">"-12-31"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This file looks like this:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">siteinfo</span><span class="op">)</span></span></code></pre></div>
<p>Next, the data can be ingested for all sites at once. Let’s do it for
different data types again.</p>
<div class="section level3">
<h3 id="fluxnet-1">FLUXNET<a class="anchor" aria-label="anchor" href="#fluxnet-1"></a>
</h3>
<div class="section level4">
<h4 id="meteo-data-1">Meteo data<a class="anchor" aria-label="anchor" href="#meteo-data-1"></a>
</h4>
<p>This ingests meteorological data from the FLUXNET files for variables
temperature, precipitation, VPD, shortwave incoming radiation, net
radiation, and atmospheric pressure. Arguments that are specific for
this data source are provided in the <code>settings</code> list.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ddf_fluxnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  siteinfo  <span class="op">=</span> <span class="va">siteinfo</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"fluxnet"</span>,</span>
<span>  getvars   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>temp <span class="op">=</span> <span class="st">"TA_F"</span>, </span>
<span>                   prec <span class="op">=</span> <span class="st">"P_F"</span>, </span>
<span>                   vpd  <span class="op">=</span> <span class="st">"VPD_F"</span>, </span>
<span>                   ppfd <span class="op">=</span>  <span class="st">"SW_IN_F"</span>, </span>
<span>                   netrad <span class="op">=</span> <span class="st">"NETRAD"</span>, </span>
<span>                   patm <span class="op">=</span> <span class="st">"PA_F"</span></span>
<span>                   <span class="op">)</span>,</span>
<span>  dir       <span class="op">=</span> <span class="st">"/data/scratch/bstocker/FLUXNET-2015_Tier1/20191024/DD/"</span>,  <span class="co"># adjust this with your local path</span></span>
<span>  settings  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    dir_hh <span class="op">=</span> <span class="st">"/data/scratch/bstocker/FLUXNET-2015_Tier1/20191024/HH/"</span>, <span class="co"># adjust this with your local path</span></span>
<span>    getswc <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  timescale <span class="op">=</span> <span class="st">"d"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Additional variables defined at a daily time scale can be derived
from half-hourly data. For example daily minimum temperature can be
obtained as follows:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ddf_tmin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  siteinfo  <span class="op">=</span> <span class="va">siteinfo</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"fluxnet"</span>,</span>
<span>  getvars   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>tmin <span class="op">=</span> <span class="st">"TMIN_F"</span><span class="op">)</span>,</span>
<span>  dir       <span class="op">=</span> <span class="st">"/data/scratch/bstocker/FLUXNET-2015_Tier1/20191024/DD/"</span>,  <span class="co"># adjust this with your local path</span></span>
<span>  settings  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    dir_hh <span class="op">=</span> <span class="st">"/data/scratch/bstocker/FLUXNET-2015_Tier1/20191024/HH/"</span>, <span class="co"># adjust this with your local path</span></span>
<span>    getswc <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  timescale <span class="op">=</span> <span class="st">"d"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="flux-data-1">Flux data<a class="anchor" aria-label="anchor" href="#flux-data-1"></a>
</h4>
<p>As described above for a single site, the same function can also be
used to read in other FLUXNET variables (e.g., CO2 flux data) and
conduct data filtering steps. Here, we’re reading daily GPP and
uncertainty (standard error), based on the nighttime flux decomposition
method (<code>""GPP_NT_VUT_REF""</code>), keep only data where at least
80% is based on non-gapfilled half-hourly data
(<code>threshold_GPP = 0.8</code>), and where the daytime and
nighttime-based estimates are consistent, that is, where their
difference is below the the 97.5% and above the 2.5% quantile
(<code>filter_ntdt = TRUE</code>, see also
<code>?get_obs_bysite_fluxnet2015</code>).</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings_fluxnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  getswc       <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  filter_ntdt  <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  threshold_GPP<span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  remove_neg   <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">ddf_fluxnet_gpp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  siteinfo <span class="op">=</span> <span class="va">siteinfo</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  source   <span class="op">=</span> <span class="st">"fluxnet"</span>,</span>
<span>  getvars  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>gpp <span class="op">=</span> <span class="st">"GPP_NT_VUT_REF"</span>,</span>
<span>  pp_unc   <span class="op">=</span> <span class="st">"GPP_NT_VUT_SE"</span><span class="op">)</span>,</span>
<span>  dir      <span class="op">=</span> <span class="st">"/data/scratch/bstocker/FLUXNET-2015_Tier1/20191024/DD/"</span>, <span class="co"># adjust this with your local path</span></span>
<span>  settings <span class="op">=</span> <span class="va">settings_fluxnet</span>,</span>
<span>  timescale<span class="op">=</span> <span class="st">"d"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="watch-wfdei-1">WATCH-WFDEI<a class="anchor" aria-label="anchor" href="#watch-wfdei-1"></a>
</h3>
<p>This extracts from original WATCH-WFDEI files, provided as NetCDF
(global, 0.5 degree resolution), provided as monthly files containing
all days in each month. The data directory specified here
(<code>dir = "~/data/watch_wfdei/"</code>) contains subdirectories with
names containing the variable names (corresponding to the ones specified
by the argument <code>getvars = list(temp = "Tair")</code>).</p>
<p>A bias correction may be applied by specifying the settings as in the
example below. By specifying <code>correct_bias = "worldclim"</code>
(the only option currently available), this uses a high-resolution
(30’’) monthly climatology based on years 1970-2000 and corrects the
WATCH-WFDEI data by month, based on the difference (ratio for variables
other than temperature) of its monthly means, averaged across
1979-2000.</p>
<p>WATCH-WFDEI data is available for years from 1979. If
<code>year_start</code> is before that, the mean seasonal cycle,
averaged across 1979-1988 is returned for all years before 1979.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ddf_watch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  siteinfo <span class="op">=</span> <span class="va">siteinfo</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      year_star <span class="op">=</span> <span class="fl">2018</span>,</span>
<span>      year_end <span class="op">=</span> <span class="fl">2018</span></span>
<span>    <span class="op">)</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"watch_wfdei"</span>,</span>
<span>  getvars   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"temp"</span>, <span class="st">"prec"</span><span class="op">)</span>,</span>
<span>  dir       <span class="op">=</span> <span class="st">"~/data/watch_wfdei/"</span>  <span class="co"># adjust this with your local path</span></span>
<span>  <span class="co"># settings  = list(correct_bias = "worldclim", dir_bias = "~/data/worldclim")</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cru-ts-1">CRU TS<a class="anchor" aria-label="anchor" href="#cru-ts-1"></a>
</h3>
<p>This extracts monthly data from the CRU TS data. Interpolation to
daily values is done using a wather generator for daily precipitation
(given monthly total precipitation and number of wet days in each
month), and a polynomial that conserves monthly means for all other
variables.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ddf_cru</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  siteinfo <span class="op">=</span> <span class="va">siteinfo</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"cru"</span>,</span>
<span>  getvars   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tmax"</span><span class="op">)</span>,</span>
<span>  dir       <span class="op">=</span> <span class="st">"~/data/cru/ts_4.01/"</span>  <span class="co"># adjust this with your local path</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Check it out for the first site (BE-Vie).</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ddf_fluxnet</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ddf_watch</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">temp</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"royalblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ddf_cru</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">tmax</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fu">ymd</span><span class="op">(</span><span class="st">"2000-01-01"</span><span class="op">)</span>, <span class="fu">ymd</span><span class="op">(</span><span class="st">"2005-12-31"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="modis-lp-daac-1">MODIS LP DAAC<a class="anchor" aria-label="anchor" href="#modis-lp-daac-1"></a>
</h3>
<p>This uses the <a href="https://docs.ropensci.org/MODISTools/" class="external-link">MODISTools</a> R package
making its interface consistent with ingestr. Settings can be specified
and passed on using the <code>settings</code> argument. To facilitate
the selection of data products and bands to be downloaded, you may use
the function <code>get_settings_modis)</code> which defines defaults for
different data bundles
(<code>c("modis_fpar", "modis_ndvi", "modis_evi")</code> are
available).</p>
<ul>
<li>
<code>"modis_fpar"</code>: MODIS collection 6, MCD15A3H, band
<code>Fpar_500m</code>
</li>
<li>
<code>"modis_lai"</code>: MODIS collection 6, MCD15A3H, band
<code>Lai_500m</code>
</li>
<li>
<code>"modis_evi"</code>: MODIS collection 6, MOD13Q1, band
<code>250m_16_days_EVI</code>
</li>
<li>
<code>"modis_ndvi"</code>: MODIS collection 6, MOD13Q1, band
<code>250m_16_days_NDVI</code>
</li>
</ul>
<p>The filtering criteria are hard-coded specifically for each product,
using its respective quality control information (see function
<code><a href="../reference/gapfill_interpol.html">gapfill_interpol()</a></code> in
<code>R/ingest_modis_bysite.R</code>).</p>
<p>Downloading with parallel jobs is available for the
<code>"modis"</code> data ingest, using the package <a href="https://github.com/tidyverse/multidplyr" class="external-link">multidplyr</a>. This is
not (yet) available on CRAN, but can be installed with
<code>devtools::install_github("tidyverse/multidplyr")</code>. To do
parallel downloading, set the following arguments in the function
<code><a href="../reference/ingest.html">ingest()</a></code>:
<code>parallel = TRUE, ncores = &lt;number_of_parallel_jobs&gt;</code>.</p>
<p>The following example is for downloading MODIS NDVI data.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings_modis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_settings_modis.html">get_settings_modis</a></span><span class="op">(</span></span>
<span>  bundle            <span class="op">=</span> <span class="st">"modis_ndvi"</span>,</span>
<span>  data_path         <span class="op">=</span> <span class="st">"~/data/modis_subsets/"</span>,</span>
<span>  method_interpol   <span class="op">=</span> <span class="st">"loess"</span>,</span>
<span>  keep              <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  overwrite_raw     <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  overwrite_interpol<span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  network           <span class="op">=</span> <span class="st">"FLUXNET"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>This can now be used to download the data to the directory specified
by argument <code>data_path</code> of function
<code><a href="../reference/get_settings_gee.html">get_settings_gee()</a></code>.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_modis_fpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  <span class="va">siteinfo_fluxnet2015</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, </span>
<span>  source <span class="op">=</span> <span class="st">"modis"</span>,</span>
<span>  settings <span class="op">=</span> <span class="va">settings_modis</span>, </span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>This can now be used to download the data to the directory specified
by argument <code>data_path</code> of function
<code><a href="../reference/get_settings_gee.html">get_settings_gee()</a></code>. The data downloaded through MODISTools
is then stored in <code>&lt;data_path&gt;/raw/</code>. When calling the
functions <code><a href="../reference/ingest.html">ingest()</a></code> or <code><a href="../reference/ingest_bysite.html">ingest_bysite()</a></code> with the
setting <code>overwrite_raw = FALSE</code>, the raw data file is read
and not re-downloaded if available locally. Raw data contains
information only for dates where MODIS data is provided.
<code><a href="../reference/ingest.html">ingest()</a></code> and <code><a href="../reference/ingest_bysite.html">ingest_bysite()</a></code> interpolate to
daily values following the setting <code>method_interpol</code>.</p>
<p>Note also that downloaded raw data are cutouts including pixels of 1
km within the focal point indicated by the site longitude and latitude
(using arguments <code>km_lr = 1.0</code> and <code>km_ab = 1.0</code>
in the <code><a href="https://rdrr.io/pkg/MODISTools/man/mt_subset.html" class="external-link">MODISTools::mt_subset()</a></code> call). This is hard-coded in
ingestr. To select a smaller radius of pixels around the focal point
included for taking the mean, set the setting <code>n_focal</code> to an
integer (0:N), with 0 selecting only the single centre pixel in which
the site is located, N=1 for including one pixel around the centre (nine
in total), N=2 for 25 in total etc.</p>
<p>Plot the ingested data.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_fapar_ingestr_bysite</span><span class="op">(</span></span>
<span>  <span class="va">df_modis_fpar</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">2010</span><span class="op">:</span><span class="fl">2015</span><span class="op">)</span>, </span>
<span>  <span class="va">settings_modis</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot_fapar_ingestr_bysite</span><span class="op">(</span></span>
<span>  <span class="va">df_modis_fpar</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">2010</span><span class="op">:</span><span class="fl">2015</span><span class="op">)</span>, </span>
<span>  <span class="va">settings_modis</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot_fapar_ingestr_bysite</span><span class="op">(</span></span>
<span>  <span class="va">df_modis_fpar</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">2010</span><span class="op">:</span><span class="fl">2015</span><span class="op">)</span>, </span>
<span>  <span class="va">settings_modis</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="google-earth-engine-1">Google Earth Engine<a class="anchor" aria-label="anchor" href="#google-earth-engine-1"></a>
</h3>
<p>Using the same settings as specified above, we can download MODIS
FPAR data for multiple sites at once from GEE:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings_gee</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_settings_gee.html">get_settings_gee</a></span><span class="op">(</span></span>
<span>  bundle            <span class="op">=</span> <span class="st">"modis_fpar"</span>,</span>
<span>  python_path       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"which python"</span>, intern <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  gee_path          <span class="op">=</span> <span class="st">"~/google_earth_engine_subsets/gee_subset/"</span>,    <span class="co"># adjust this with your local path</span></span>
<span>  data_path         <span class="op">=</span> <span class="st">"~/data/gee_subsets/"</span>,    <span class="co"># adjust this with your local path</span></span>
<span>  method_interpol   <span class="op">=</span> <span class="st">"linear"</span>,</span>
<span>  keep              <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  overwrite_raw     <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  overwrite_interpol<span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">df_gee_modis_fpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  siteinfo<span class="op">=</span> <span class="va">siteinfo</span>,</span>
<span>  source  <span class="op">=</span> <span class="st">"gee"</span>,</span>
<span>  settings<span class="op">=</span> <span class="va">settings_gee</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Collect all plots.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list_gg</span> <span class="op">&lt;-</span> <span class="fu">plot_fapar_ingestr</span><span class="op">(</span><span class="va">df_gee_modis_fpar</span>, <span class="va">settings_gee</span><span class="op">)</span></span>
<span><span class="co">#purrr::map(list_gg, ~print(.))</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="co2-1">CO2<a class="anchor" aria-label="anchor" href="#co2-1"></a>
</h3>
<p>Ingesting CO2 data is particularly simple. We can safely assume it’s
well mixed in the atmosphere (independent of site location), and we can
use a annual mean value for all days in respective years, and use the
same value for all sites. Using the R package <a href="https://github.com/bczernecki/climate" class="external-link">climate</a>, we can load
CO2 data from Mauna Loa directly into R. This is downloading data from
<a href="ftp://aftp.cmdl.noaa.gov/products/trends/co2/co2_mm_mlo.txt" class="uri">ftp://aftp.cmdl.noaa.gov/products/trends/co2/co2_mm_mlo.txt</a>.
Here, <code><a href="../reference/ingest.html">ingest()</a></code> is a wrapper for the function
<code><a href="https://rdrr.io/pkg/climate/man/meteo_noaa_co2.html" class="external-link">climate::meteo_noaa_co2()</a></code>.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_co2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  <span class="va">siteinfo</span>,</span>
<span>  source  <span class="op">=</span> <span class="st">"co2_mlo"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Argument <code>dir</code> can be provided here, too. In that case,
CO2 data is written (after download if it’s not yet available) and read
to/from a file located at <code>&lt;dir&gt;/df_co2_mlo.csv</code>.</p>
<p>More info about the <strong>climate</strong> package and the data can
be obtained <a href="https://www.esrl.noaa.gov/gmd/ccgg/trends/data.html" class="external-link">here</a> and
by:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="fu">climate</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/climate/man/meteo_noaa_co2.html" class="external-link">meteo_noaa_co2</a></span></span></code></pre></div>
<p><strong>THE FOLLOWING IS UNDER CONSTRUCTION. MAKE READABLE FOR FILE
AVAILABLE HERE: <a href="http://www.pik-potsdam.de/~mmalte/rcps/" class="external-link uri">http://www.pik-potsdam.de/~mmalte/rcps/</a></strong></p>
<p>Mauna Loa CO2 is not available for years before 1958. Alternative CO2
data is from CMIP standard forcing with merged time series from
atmospheric measurements and ice core reconstructions. This can be
selected with <code>source = "co2_cmip</code>.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_co2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  <span class="va">siteinfo</span>,</span>
<span>  source  <span class="op">=</span> <span class="st">"co2_cmip"</span>,</span>
<span>  dir <span class="op">=</span> <span class="st">"~/data/co2"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="etopo1">ETOPO1<a class="anchor" aria-label="anchor" href="#etopo1"></a>
</h3>
<p>This reads from the 1 arc minutes resolution ETOPO1 global elevation
data (reading from a Geo-TIFF file). The nested data column contains a
tibble one value for variable <code>elv</code>. Download the data from
<a href="https://www.ngdc.noaa.gov/mgg/global/" class="external-link">here</a> and specify the
local path with the argument <code>dir</code>.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_etopo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  <span class="va">siteinfo</span>,</span>
<span>  source <span class="op">=</span> <span class="st">"etopo1"</span>,</span>
<span>  dir <span class="op">=</span> <span class="st">"~/data/etopo/"</span>  <span class="co"># adjust this with your local path</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="root-zone-water-storage-capacity">Root-zone water-storage capacity<a class="anchor" aria-label="anchor" href="#root-zone-water-storage-capacity"></a>
</h3>
<p>This reads from the 0.05 degrees resolution map of root-zone
water-storage capacity from <a href="https://www.nature.com/articles/s41561-023-01125-2" class="external-link">Stocker et
al. (2023)</a>. The nested data column contains a tibble with one value
for one variable <code>whc</code>. Download the data from <a href="https://doi.org/10.5281/zenodo.10885724" class="external-link">here</a> and specify the
local path with the argument <code>dir</code>.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_stocker23</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  <span class="va">siteinfo</span>,</span>
<span>  source <span class="op">=</span> <span class="st">"stocker23"</span>,</span>
<span>  dir  <span class="op">=</span><span class="st">"~/data/mct_data/"</span>  <span class="co"># adjust this with your local path</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="hwsd-1">HWSD<a class="anchor" aria-label="anchor" href="#hwsd-1"></a>
</h3>
<p>Four steps are required before you can use <code><a href="../reference/ingest.html">ingest()</a></code> to
get HWSD data:</p>
<ol style="list-style-type: decimal">
<li>The the modified version of David LeBauer’s <a href="https://github.com/dlebauer/rhwsd" class="external-link">rhwsd</a> R package. The
modified version can be installed by:</li>
</ol>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="va">devtools</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"stineb/rhwsd"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># XXX to change to https://github.com/bluegreen-labs/hwsdr</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Install additionally required packages: DBI and RSQLite.</li>
</ol>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list.of.packages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DBI"</span>, <span class="st">"RSQLite"</span><span class="op">)</span></span>
<span><span class="va">new.packages</span> <span class="op">&lt;-</span> <span class="va">list.of.packages</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">list.of.packages</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span>,<span class="st">"Package"</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">new.packages</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="va">new.packages</span><span class="op">)</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Download the HWSD data file <a href="http://webarchive.iiasa.ac.at/Research/LUC/External-World-soil-database/HWSD_Data/HWSD_RASTER.zip" class="external-link">HWSD_RASTER.zip</a>
and extract.</li>
<li>Move the extracted files to a local directory and adjust the file
path in the <code>settings</code> argument accordingly (in this example:
<code>"~/data/hwsd/HWSD_RASTER/hwsd.bil"</code>).</li>
</ol>
<p>Then, use similarly to above, with providing the path to the
downloaded file with the <code>settings</code> argument:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_hwsd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  <span class="va">siteinfo</span>,</span>
<span>  source <span class="op">=</span> <span class="st">"hwsd"</span>,</span>
<span>  settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fil <span class="op">=</span> <span class="st">"~/data/hwsd/HWSD_RASTER/hwsd.bil"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="wwf-ecoregions">WWF Ecoregions<a class="anchor" aria-label="anchor" href="#wwf-ecoregions"></a>
</h3>
<p>WWF Ecoregions data are provided as a shapefile, available for
download <a href="http://assets.worldwildlife.org/publications/15/files/original/official_teow.zip" class="external-link">here</a>,
or <a href="https://databasin.org/datasets/68635d7c77f1475f9b6c1d1dbe0a4c4c" class="external-link">here</a>.
A description of the data is available <a href="http://omap.africanmarineatlas.org/BIOSPHERE/data/note_areas_sp/Ecoregions_Ecosystems/WWF_Ecoregions/WWFecoregions.htm" class="external-link">here</a>.
Download the zipped directory and adjust the argument <code>dir</code>
to the path of the directory where file <code>wwf_terr_ecos.shp</code>
is located. Set the settings list with
<code>layer = "wwf_terr_ecos"</code>. Then, ingest data by:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wwf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  <span class="va">siteinfo</span>,</span>
<span>  source <span class="op">=</span> <span class="st">"wwf"</span>,</span>
<span>  dir <span class="op">=</span> <span class="st">"~/data/biomes/wwf_ecoregions/official/"</span>,</span>
<span>  settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>layer <span class="op">=</span> <span class="st">"wwf_terr_ecos"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sitename</span>, <span class="va">lon</span>, <span class="va">lat</span>, <span class="va">BIOME_NAME</span><span class="op">)</span></span></code></pre></div>
<p>The following provides the biome codes. This information is
additionally added by the ingestr package in column
<code>BIOME_NAME</code>:</p>
<table class="table">
<thead><tr class="header">
<th>Code</th>
<th>Biome</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Tropical &amp; Subtropical Moist Broadleaf Forests</td>
</tr>
<tr class="even">
<td>2</td>
<td>Tropical &amp; Subtropical Dry Broadleaf Forests</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Tropical &amp; Subtropical Coniferous Forests</td>
</tr>
<tr class="even">
<td>4</td>
<td>Temperate Broadleaf &amp; Mixed Forests</td>
</tr>
<tr class="odd">
<td>5</td>
<td>Temperate Conifer Forests</td>
</tr>
<tr class="even">
<td>6</td>
<td>Boreal Forests/Taiga</td>
</tr>
<tr class="odd">
<td>7</td>
<td>Tropical &amp; Subtropical Grasslands, Savannas &amp;
Shrublands</td>
</tr>
<tr class="even">
<td>8</td>
<td>Temperate Grasslands, Savannas &amp; Shrublands</td>
</tr>
<tr class="odd">
<td>9</td>
<td>Flooded Grasslands &amp; Savannas</td>
</tr>
<tr class="even">
<td>10</td>
<td>Montane Grasslands &amp; Shrublands</td>
</tr>
<tr class="odd">
<td>11</td>
<td>Tundra</td>
</tr>
<tr class="even">
<td>12</td>
<td>Mediterranean Forests, Woodlands &amp; Scrub</td>
</tr>
<tr class="odd">
<td>13</td>
<td>Deserts &amp; Xeric Shrublands</td>
</tr>
<tr class="even">
<td>14</td>
<td>Mangroves</td>
</tr>
</tbody>
</table>
<p>Please cite as: <em>Olson, D. M., Dinerstein, E. ,Wikramanayake, E.
D., Burgess, N. D., Powel, G. V. N., Underwood, E. C., Damico, J. A.,
Itoua, I., Strand, H. E., Morrison, J. C., Loucks, C. J., Ricketts, T.
H., Kura, Y., Lamoreux, J. F., Wettengel, W. W., Hedao, P., and Kassem,
K.R. 2001 Terrestrial ecoregions of the world: A new map of life on
earth. BioScience, 51(11):933–938.</em></p>
</div>
<div class="section level3">
<h3 id="nitrogen-deposition-1">Nitrogen deposition<a class="anchor" aria-label="anchor" href="#nitrogen-deposition-1"></a>
</h3>
<p>This reads nitrogen deposition from global annual maps by Lamarque et
al. (2011). This provides annual data separately for NHx and NOy in gN
m<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mrow><mo>−</mo><mn>2</mn></mrow></msup><annotation encoding="application/x-tex">^{-2}</annotation></semantics></math>
yr<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><annotation encoding="application/x-tex">^{-1}</annotation></semantics></math>
from a global map provided at half-degree resolution and covering years
1860-2009.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_ndep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  <span class="va">siteinfo_fluxnet2015</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"ndep"</span>,</span>
<span>  timescale <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  dir       <span class="op">=</span> <span class="st">"~/data/ndep_lamarque/"</span>,</span>
<span>  verbose   <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="soilgrids-1">SoilGrids<a class="anchor" aria-label="anchor" href="#soilgrids-1"></a>
</h3>
<p>Point extractions from <a href="https://soilgrids.org/" class="external-link">SoilGrids</a>
layers are implemented following <a href="https://git.wur.nl/isric/soilgrids/soilgrids.notebooks/-/blob/master/markdown/xy_info_from_R.md" class="external-link">this</a>
and are provided through <a href="https://www.isric.org/" class="external-link">ISRIC</a>.</p>
<p>Available layers, variable naming conventions, and units are
described above (section <em>Examples for a single site -
SoilGrids</em>) and <a href="https://www.isric.org/explore/soilgrids/faq-soilgrids#What_do_the_filename_codes_mean" class="external-link">here</a>.
Which variable is to be extracted and for which soil depth layer can be
specified in the settings, a list returned by the function call
<code><a href="../reference/get_settings_soilgrids.html">get_settings_soilgrids()</a></code>.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings_soilgrids</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_settings_soilgrids.html">get_settings_soilgrids</a></span><span class="op">(</span>varnam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nitrogen"</span>, <span class="st">"cec"</span><span class="op">)</span>, layer <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>Now, the data can be ingested.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_soilgrids</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  <span class="va">siteinfo_fluxnet2015</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"soilgrids"</span>,</span>
<span>  settings  <span class="op">=</span> <span class="va">settings_soilgrids</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>This returns a data frame with a nested column <code>data</code>
which contains actually just a 1 x 1 tibble. This is to be consistent
with other ingest options. You may prefer to have a normal flat data
frame. Just do:</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_soilgrids</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="isric-wise30sec-1">ISRIC WISE30sec<a class="anchor" aria-label="anchor" href="#isric-wise30sec-1"></a>
</h3>
<p>This reads from local files. Download them from ISRIC <a href="https://data.isric.org/geonetwork/srv/eng/catalog.search#/metadata/dc7b283a-8f19-45e1-aaed-e9bd515119bc" class="external-link">here</a>.</p>
<p>See above (section <em>Examples for a single site</em>) for a
description of variables and soil layers.</p>
<p>The following settings specify data extraction for the C:N ratio of
the top three layers. The returned value is the mean across selected
soil layers, weighted by the respective layer’s depth. <code>dir</code>
specifies the path to the downloaded data bundle. Don’t change the
structure of it. ingestr reads from two files:
<code>&lt;dir&gt;/GISfiles/wise30sec_fin</code> and
<code>&lt;dir&gt;/Interchangeable_format/HW30s_FULL.txt</code>.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings_wise</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_settings_wise.html">get_settings_wise</a></span><span class="op">(</span>varnam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CNrt"</span>, <span class="st">"CECS"</span><span class="op">)</span>, layer <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>Now, the data can be ingested.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wise</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  <span class="va">siteinfo_fluxnet2015</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"wise"</span>,</span>
<span>  settings  <span class="op">=</span> <span class="va">settings_wise</span>,</span>
<span>  dir       <span class="op">=</span> <span class="st">"~/data/soil/wise"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="gsde-soil-1">GSDE Soil<a class="anchor" aria-label="anchor" href="#gsde-soil-1"></a>
</h3>
<p>Global Soil Dataset for use in Earth System Models (GSDE) by <a href="https://doi.org/10.1002/2013MS000293" class="external-link">Shangguan et al. 2014</a>,
obtained from <a href="http://globalchange.bnu.edu.cn/research/soilwd.jsp" class="external-link">here</a>.
Available variables and layers are given in the table in the section
above (<em>Examples for a single site - GSDE Soil</em>)</p>
<p>Specify the settings directly as a list with elements
<code>varnam</code> (a vector of character strings specifying the
variables as defined in the table above), and <code>layer</code> (a
vector of integers specifying the layers over which a depth-weighted
average is taken).</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings_gsde</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>varnam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PBR"</span>, <span class="st">"PHH2O"</span><span class="op">)</span>, layer <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<p>Now, the data can be ingested.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_gsde</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  <span class="va">siteinfo_fluxnet2015</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"gsde"</span>,</span>
<span>  settings  <span class="op">=</span> <span class="va">settings_gsde</span>,</span>
<span>  dir       <span class="op">=</span> <span class="st">"/data/archive/soil_shangguan_2014/data/"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>And data is returned with variables along columns inside a nested
column <code>data</code>, and sites along rows (as for all ingestr).
Make it flat by:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_gsde</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="worldclim-1">WorldClim<a class="anchor" aria-label="anchor" href="#worldclim-1"></a>
</h3>
<p>This ingests Worldclim monthly climatology (averaged over 1970-2000)
at 30 seconds spatial resolution by <a href="https://doi.org/10.1002/joc.5086" class="external-link">Fick &amp; Hijmans, 2017</a>,
obtained <a href="https://www.worldclim.org/data/worldclim21.html" class="external-link">here</a>.
Available variables are:</p>
<table style="width:99%;" class="table">
<colgroup>
<col width="13%">
<col width="73%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th>Variable name</th>
<th>Description</th>
<th>Units</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>bio</td>
<td>Bioclimatic variables (description <a href="https://www.worldclim.org/data/bioclim.html" class="external-link">here</a>)</td>
<td></td>
</tr>
<tr class="even">
<td>tmin</td>
<td>Minimum temperature</td>
<td>°C</td>
</tr>
<tr class="odd">
<td>tmax</td>
<td>Maximum temperature</td>
<td>°C</td>
</tr>
<tr class="even">
<td>tavg</td>
<td>Average temperature</td>
<td>°C</td>
</tr>
<tr class="odd">
<td>prec</td>
<td>Precipitation</td>
<td>mm</td>
</tr>
<tr class="even">
<td>srad</td>
<td>Solar radiation</td>
<td>kJ m-2 day-1</td>
</tr>
<tr class="odd">
<td>wind</td>
<td>Wind speed</td>
<td>m s-1</td>
</tr>
<tr class="even">
<td>vapr</td>
<td>Water vapour pressure</td>
<td>kPa</td>
</tr>
</tbody>
</table>
<p>Specify the settings directly as a list with elements
<code>varnam</code> (a vector of character strings specifying the
variables as defined in the table above), and <code>layer</code> (a
vector of integers specifying the layers over which a depth-weighted
average is taken).</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings_worldclim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>varnam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now, the data can be ingested.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_worldclim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  <span class="va">siteinfo_fluxnet2015</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"worldclim"</span>,</span>
<span>  settings  <span class="op">=</span> <span class="va">settings_worldclim</span>,</span>
<span>  dir       <span class="op">=</span> <span class="st">"~/data/worldclim"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="dummy-fapar-data">Dummy fAPAR data<a class="anchor" aria-label="anchor" href="#dummy-fapar-data"></a>
</h3>
<p>Ingestr, i.a., designed to collect forcing data for the rsofun
modelling framework. Within that, you may chose to run the P-model for
predicting leaf-level quantities (acclimated Vcmax and Jmax). These are
independent of fAPAR. Still, forcing for fAPAR (variable standard name
<code>fapar</code>) is required and can be set to 1.0 for all sites and
required dates. To get an object in the required standard format, use
<code>ingest</code> with <code>source = "fapar_unity"</code>:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ddf_fapar_unity</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  siteinfo  <span class="op">=</span> <span class="va">siteinfo</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"fapar_unity"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">ddf_fapar_unity</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start bottom-8">
            <div class="col-xs-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/geco-bern" target="_blank" class="external-link">
                          <div class="icon fab fa-github"></div></a>
                        <a href="https://geco-group.org" target="_blank" class="external-link">
                          <div class="icon fa fa-flask"></div></a>
                        <a href="http://twitter.com/SteniBocker/" target="_blank" class="external-link">
                          <div class="icon fab fa-twitter"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://geco-group.org/" class="external-link">GECO</a></li>
                            <li><a href="https://geco-group.org/people/" class="external-link">Our Team</a></li>
                            <li><a href="https://geco-group.org/contact/" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://github.com/geco-bern" class="external-link">Packages</a></li>
                            <li><a href="https://geco-group.org/publication/" class="external-link">Publications</a></li>
                            <li><a href="https://geco-group.org/post/" class="external-link">Blog</a></li>
                        </ul>
</div>

                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->

      </footer>
</div>






  </body>
</html>
